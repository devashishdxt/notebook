<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Avalanche Consensus Protocol - Notebook</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { } 
            if (theme === null || theme === undefined) { theme = default_theme; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <ol class="chapter"><li><a href="schnorr_signature_algorithm.html"><strong aria-hidden="true">1.</strong> Schnorr Signature Algorithm</a></li><li><a href="schnorr_musig_scheme.html"><strong aria-hidden="true">2.</strong> Schnorr Multi-Signature Scheme</a></li><li><a href="avalanche_consensus.html" class="active"><strong aria-hidden="true">3.</strong> Avalanche Consensus Protocol</a></li></ol>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Notebook</h1> 

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <a class="header" href="#avalanche-consensus-protocol" id="avalanche-consensus-protocol"><h1>Avalanche Consensus Protocol</h1></a>
<p>Avalanche is a new family of consensus protocols inspired by gossip algorithms. The protocol is based
on random sampling and meta-stable decision, and provide a strong probabilistic safety guarantee.</p>
<p>This protocol family achieves its properties by humbly cheating in three different ways:</p>
<ol>
<li>Adopting a safety guarantee that is probabilistic.</li>
<li>Establishing only partial order between dependent transactions.</li>
<li>No liveliness guarantee for misbehaving clients.</li>
</ol>
<a class="header" href="#guarantees" id="guarantees"><h2>Guarantees</h2></a>
<p>Avalanche protocol provides the following guarantees with high probability:</p>
<ul>
<li><strong>Safety:</strong> No two correct nodes will accept conflicting transactions.</li>
<li><strong>Liveliness:</strong> Any transaction issued by a correct client will eventually be accepted by every correct
node.</li>
</ul>
<a class="header" href="#assumptions" id="assumptions"><h2>Assumptions</h2></a>
<p>Avalanche protocol makes following assumptions:</p>
<ul>
<li>A synchronous network.</li>
<li>All members of a network are not known to all participants.</li>
<li>A safe bootstrapping system that enables a node to connect with sufficiently many correct nodes.</li>
</ul>
<a class="header" href="#approach" id="approach"><h2>Approach</h2></a>
<p>Avalanche starts with a non-Byzantine protocol and progressively build on it to arrive at Byzantine Fault
Tolerant (BFT) protocol. It consists of following four protocols:</p>
<ol>
<li>Slush</li>
<li>Snowflake</li>
<li>Snowball</li>
<li>Avalanche</li>
</ol>
<a class="header" href="#slush-introducing-meta-stability" id="slush-introducing-meta-stability"><h3>Slush: Introducing Meta-stability</h3></a>
<ul>
<li>A node starts out with an uncolored state.</li>
<li>Upon receiving a transaction, an uncolored node updates its own colour to the one carried in the
transaction and initiates a query.</li>
<li>To perform a query, a node picks a small, constant sized \( (k)\) sample of the network uniformly
at random, and sends a query message.</li>
<li>Upon receiving a query, an uncolored node adopts the colour in the query, responds with that colour,
and initiates its own query, whereas a coloured node simply responds with its current colour.</li>
<li>Once the querying node collects \( k\) responses, it checks if a fraction \( \geq \alpha k\) are
for the same colour, where \( \alpha \gt 0.5\) is a protocol parameter.</li>
<li>If the \( \alpha k\) threshold is met and the sampled colour differs from the node's own colour, the
node flips to that colour.</li>
<li>It then goes back to the query step , and initiates a subsequent round of query, for a total of
\( m\) rounds.</li>
<li>Finally, the node decides the colour it ended up with after \( m\) rounds.</li>
</ul>
<a class="header" href="#snowflake-bft" id="snowflake-bft"><h3>Snowflake: BFT</h3></a>
<ul>
<li>Each node maintains a counter \( cnt\).</li>
<li>Upon every colour change, the node resets \( cnt\) to \( 0\).</li>
<li>Upon every successful query that yields \( \geq \alpha k\) responses for the same colour as the node,
the node increments \( cnt\).</li>
<li>A node accepts the current colour when its counter exceeds \( \beta\), another security parameter.</li>
</ul>
<a class="header" href="#snowball-adding-confidence" id="snowball-adding-confidence"><h3>Snowball: Adding Confidence</h3></a>
<ul>
<li>Each node maintains a <em>confidence counter</em>.</li>
<li>Upon every successful query, the node increments its confidence counter for that colour.</li>
<li>A node switches colours when the confidence in its current colour becomes lower than the confidence
value of the new colour.</li>
<li>A node decides a colour if, during a certain number of consecutive queries, its confidence for that
colour exceeds that of other colours.</li>
</ul>
<a class="header" href="#avalanche-adding-a-dag" id="avalanche-adding-a-dag"><h3>Avalanche: Adding a DAG</h3></a>
<ul>
<li>Each node maintains a dynamic append-only Directed Acyclic Graph (DAG) of all known transactions.</li>
<li>The DAG has single sink that is <em>genesis vertex</em>.</li>
<li>When a client creates a transaction, it names one or more <em>parents</em>, which are included inseparably
in that transaction and form the edges of the DAG.</li>
</ul>
<p>We use the term <em>ancestor set</em> to refer to all transactions reachable via parent edges back in history,
and <em>progeny</em> to refer to all children transactions and their offspring.</p>
<p>The central challenge in the maintenance of the DAG is to choose among <em>conflicting transactions</em>. For
example, in a cryptocurrency application, transactions that spend the same funds (<em>double-spends</em>)
conflict, and form a <em>conflict set</em>, out of which only a single one can be accepted. Note that the conflict
set of a correct transaction is always a singleton. Also, it is worth noting that each transaction in a
conflict set may have different parent transaction (this depends on implementation of parent selection).</p>
<ul>
<li>When a transaction \( T\) is queried, all transactions reachable from \( T\) by following the DAG
edges are implicitly part of the query.</li>
<li>A node will only respond positively to the query if \( T\) and its entire <em>ancestry</em> are currently the
preferred option in their respective conflict sets.</li>
<li>If more than a threshold of responders vote positively, the transaction is said to collect a <em>chit</em>,
\( c_{uT} = 1\), otherwise \( c_{uT} = 0\).</li>
<li>Nodes then compute their <em>confidence</em> as the sum of chit values in the <em>progeny</em> of that transaction.</li>
<li>Nodes query a transaction just once and rely on new vertices and chits, added to progeny, to build up
their confidence.</li>
<li>Ties are broken by an initial preference for the first-seen transactions.</li>
</ul>
<a class="header" href="#specification" id="specification"><h2>Specification</h2></a>
<ul>
<li>Each correct node \( u\) keeps track of all transactions it has learned about in a set \( \mathcal{T}_u\),
partitioned into mutually exclusive conflict sets \( \mathcal{P}_T\), where \( T \in \mathcal{T}_u\).
Since conflicts are transitive, if \( T_i\) and \( T_j\) are conflicting, then
\( \mathcal P_{T_i} = \mathcal P_{T_j}\)</li>
<li>We write \( T' \leftarrow T\) if \( T\) has a parent edge to \( T'\).</li>
<li>Each node \( u\) can compute a confidence value for transaction \( T\), \( d_u(T)\), from the
progeny as follows:
\[ d_u(T) = \sum_{T' \in \mathcal T_u, T \xleftarrow{\ast} T'} c_{uT'} \]
Above formula means that the <em>confidence value</em> of a transaction is sum of chits collected
by its children and their off-springs (<em>progeny</em>).</li>
</ul>
<style scoped>
    .chit_confidence {
        padding-left:20%; 
        padding-right:20%;
    }

    @media (max-width: 1100px) {
        .chit_confidence {
            padding-left:10%; 
            padding-right:10%;
        }
    }
</style>
<div class = "chit_confidence">
    <img src="./images/chit_confidence.png" />
</div>
<p><strong>Note:</strong> Above image is just for providing an example and the values may not be accurate.</p>
<a class="header" href="#process" id="process"><h3>Process</h3></a>
<ul>
<li>When a node \( u\) discovers a transaction \( T\) through query, it starts a one-time query process by
sampling \( k\) random peers.</li>
<li>A query starts by adding \( T\) to \( \mathcal T\), initializing \( c_T\) to \( 0\), and then sending
a message to selected peers.</li>
<li>Node \( u\) answers a query by checking weather each \( T'\) such that \( T' \xleftarrow{\ast} T\) (i.e.,
every parent of \( T\)) is currently preferred among their respective conflict sets, \( \mathcal P_{T'}\).
<ul>
<li>If every single ancestor \( T'\) fulfills this criterion, the transaction is said to be <em>strongly preferred</em>,
and receives a yes-vote(1).</li>
<li>A failure of this criterion at any \( T'\) yields a no-vote (0).</li>
</ul>
</li>
<li>When \( u\) accumulates \( k\) responses, it checks weather there are \( \alpha k\) yes-votes for \( T\),
and if so grants the chit \( c_T = 1\) for \( T\).</li>
</ul>
<p>The above mentioned process is brief of Avalanche Consensus Algorithm. To understand it fully, it is recommended to
read <strong>Section 2.6</strong> along with the <strong>pseudo-code</strong> in <a href="https://ipfs.io/ipfs/QmUy4jh5mGNZvLkjies1RWM4YuvJh5o2FYopNPVYwrRVGV">Avalanche Paper</a>.</p>
<a class="header" href="#parent-selection" id="parent-selection"><h3>Parent Selection</h3></a>
<p>The goal of the parent selection algorithm is to yield a well-structured DAG that maximizes the likelihood that
virtuous transactions will be quickly accepted by the network.</p>
<p>There are inherent trade-offs in the parent selection algorithm:</p>
<ul>
<li>Selecting well-accepted parents makes it more likely for a transaction to find support, but can lead to vote
dilution.</li>
<li>Selecting more recent parents at the frontier of the DAG can lead to stuck transactions, as the parents may turn
out to be rogue and remain unsupported.</li>
</ul>
<p>The adaptive parent selection algorithm chooses parents by starting at the DAG frontier and retreating towards
the genesis vertex until finding an eligible parent. The eligibility criteria has following four conditions:</p>
<ul>
<li>Transaction should be <em>strongly preferred</em>, i.e., every single of its ancestor is preferred among their
respective conflict sets.</li>
<li>Transaction's conflict set size should be \( 1\), i.e., there should not be any conflicting transactions to
current transaction.</li>
<li>Transaction should have a confidence value, \( d(T) \gt 0\)</li>
<li>None of this transaction's children should satisfy above three conditions.</li>
</ul>
<p>To understand more about <em>parent selection</em>, it is recommended to read <strong>Section 4</strong> along with the <strong>pseudo-code</strong> in
<a href="https://ipfs.io/ipfs/QmUy4jh5mGNZvLkjies1RWM4YuvJh5o2FYopNPVYwrRVGV">Avalanche Paper</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="schnorr_musig_scheme.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="schnorr_musig_scheme.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
            </nav>

        </div>

        

        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
